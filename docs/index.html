<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>AMR</title>
</head>

<body>
	<main>
		<p>Select File -> Decode -> Play</p>
		<p>
			<input type="file" name="file" id="file" accept=".amr">
		</p>
		<p>
			<button type="button" id="decode">Decode</button>
			<span id="decode-result"></span>
		</p>
		<p>
			<button type="button" id="play">Play</button>
			<span id="play-result"></span>
		</p>
		<p>
			<span>WAV</span>
			<audio id="audio" controls></audio>
			<a id="link" download="audio">Download</a>
		</p>
	</main>

	<script src="../dist/amrplayer.js"></script>
	<script type="module">
		const amrPlayer = new AMRPlayer();
		let amrAudio, file;

		function updateState() {
			document.getElementById('play-result').textContent = amrAudio.state;
		}

		document.getElementById('decode').addEventListener('click', async function () {
			file = document.getElementById('file').files[0];

			if (file) {
				await amrPlayer.setBlob(file);
				const url = amrPlayer.getWAV();

				document.getElementById('audio').src = url;
				document.getElementById('link').href = url;

				amrAudio = amrPlayer.getAudio(updateState);

				document.getElementById('decode-result').textContent = 'Ready';
			} else {
				alert('Please select an AMR file');
			}
		});

		document.getElementById('play').addEventListener('click', function () {
			if (amrAudio) {
				amrAudio.toggle().then(updateState);
			} else {
				alert('Please decode');
			}
		});
	</script>
</body>

</html>